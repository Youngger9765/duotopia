# 釐清問題

當 discussion.md 與其他 BDD 工作流程並用時，若出現規則衝突應如何處理優先順序？

# 定位

discussion.md：與其他 BDD 工作流程的整合章節，目前僅列出可搭配使用的流程，但未說明衝突時的優先順序或整合機制。

# 多選題

| 選項 | 描述                                                                                 |
| ---- | ------------------------------------------------------------------------------------ |
| A    | discussion.md 優先：所有工作流程都必須遵守討論模式的「討論先行，確認後執行」原則     |
| B    | 特定流程優先：依流程性質決定，例如 clarify-and-translation.md 有自己的互動規則可覆蓋 |
| C    | 明確聲明優先：用戶在對話開始時明確指定使用哪個流程，該流程規則優先                   |
| D    | 分層整合：discussion.md 作為基礎原則，其他流程是特定場景的實作細節，兩者互補不衝突   |
| E    | 無優先順序：由 AI 根據情境智能判斷應遵循哪個流程的規則                               |

# 影響範圍

- AI 在使用多個工作流程時的行為一致性
- 用戶對 AI 行為的可預測性
- discussion.md 的「與其他 BDD 工作流程的整合」章節內容
- 各個工作流程文件可能需要添加整合說明

## 優先級

Medium

---

# 解決記錄

- **回答**：自定義模式 - 「默認-任務-返回」模式（基於 D 延伸）

- **說明**：

  **核心機制：discussion.md 作為默認狀態**

  - 未執行其他 basic/ 下的檔案時，始終使用 discussion.md
  - discussion.md 在後台持續運作，是所有互動的默認模式

  **任務執行：用戶指定流程**

  - 當用戶明確指定「執行 [流程名].md」時，臨時切換到該流程
  - 被指定的流程接管控制權，按其規則執行任務
  - 例如：「執行 formulation.md」→ AI 開始制定規格

  **完成判定：產出最終檔案時**

  - 當流程產出最終檔案時視為「執行完畢」
  - formulation.md：產生完整的 DBML 或 Feature 檔案
  - discovery.md：產生釐清項目檔案和 overview.md
  - clarify-and-translation.md：更新規格檔案並移動釐清項目到 resolved/

  **自動返回：無需再次聲明**

  - 流程執行完畢後，自動返回 discussion.md
  - 不需要用戶說「回到討論模式」
  - 返回後等待用戶下一個指令（不主動提及剛完成的任務）

  **嵌套處理：單層執行，不支持嵌套**

  - 任何流程完成都直接返回 discussion.md
  - 不支持流程內再啟動另一個流程（例如：formulation 中不會自動觸發 clarify）
  - 若執行中發現需要其他流程，應先中斷當前流程，返回 discussion 由用戶決定

  **實例流程**：

  ```
  User: 我們討論新功能的細節
  AI: {討論} [進行討論...]

  User: 把我的自然語言建立一個檔案，並執行 formulation.md
  AI: {執行} 開始執行 formulation.md
      [制定規格，產生 DBML/Feature 檔案]
      [完成後自動返回 discussion.md]

  AI: [等待用戶下一個指令]
  User: 接下來...
  AI: {討論} ...
  ```

- **更新的規格檔**：docs/references/bdd-prompts/basic/discussion.md
- **變更內容**：重寫「與其他 BDD 工作流程的整合」章節，定義默認-任務-返回機制
