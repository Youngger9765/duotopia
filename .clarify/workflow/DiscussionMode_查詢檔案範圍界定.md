# 釐清問題

討論階段允許「查詢相關檔案」，但「相關」的範圍和查詢數量應如何界定？

# 定位

discussion.md：討論階段規則中的「允許行為」，目前僅說明「查詢相關檔案（讀取檔案、搜尋程式碼、檢視結構等）」，但未定義「相關」的判斷標準和查詢範圍限制。

# 多選題

| 選項 | 描述                                                                                   |
| ---- | -------------------------------------------------------------------------------------- |
| A    | 由 AI 自行判斷相關性，無明確限制（信任 AI 的判斷能力）                                 |
| B    | 限定在「討論主題直接相關」的檔案，最多查詢 10 個檔案                                   |
| C    | 採用分層查詢：第一層查詢核心檔案（2-3 個），若需要再擴展到相依檔案（最多 5-10 個總計） |
| D    | 每次查詢前都需向用戶說明要查詢哪些檔案及原因，等待確認後才執行                         |
| E    | 無限制，但需在查詢後提供摘要說明「查詢了哪些檔案及發現了什麼」                         |

# 影響範圍

- AI 在討論階段的資訊收集效率
- Token 使用量（查詢檔案會消耗 context）
- 用戶等待時間（過多查詢會延長回應時間）
- discussion.md 的「討論階段規則 > 允許行為」章節內容
- 與「建議模式流程 > 第一步：全盤了解」的一致性

# 優先級

High

---

# 解決記錄

- **回答**：C - 採用分層查詢，並增加特別條件控制

- **說明**：

  **基本原則：分層查詢**

  - 第一層：查詢核心檔案（2-3 個討論主題直接相關的檔案）
  - 第二層：若需要，擴展到相依檔案（最多 5-10 個總計）

  **特別條件 1：資料不足時的擴展機制**

  - 當現有檔案資料不足以處理問題時
  - AI 應先與用戶確認檔案的相關性
  - 列出需要再囊括進來的檔案（這時候可能會超過 10 files）
  - 經用戶確認後，將需要的檔案也囊括進來一起查詢檢視

  **特別條件 2：大量查詢前的預警機制**

  - AI 每次都應該先判斷 10 個以內的相關檔案是否足以處理此問題
  - 如果不足以，請回報有多少相關檔案
  - 告知可能會花較多的時間
  - 等用戶同意再查詢檢視

- **更新的規格檔**：docs/references/bdd-prompts/basic/discussion.md
- **變更內容**：擴充「討論階段規則 > 允許行為」章節，新增查詢檔案範圍的分層原則和特別條件
