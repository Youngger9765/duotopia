<!DOCTYPE html>
<html>
<head>
    <title>Test Students Page</title>
    <script>
        async function testStudentsPage() {
            console.log("Testing students page data fetching...");

            // First login
            const loginResponse = await fetch('http://localhost:8000/api/auth/teacher/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: 'demo@duotopia.com',
                    password: 'demo123'
                })
            });

            if (!loginResponse.ok) {
                console.error("Login failed");
                return;
            }

            const loginData = await loginResponse.json();
            const token = loginData.access_token;
            console.log("✅ Login successful");

            // Now fetch classrooms
            const classroomsResponse = await fetch('http://localhost:8000/api/teachers/classrooms', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!classroomsResponse.ok) {
                console.error("Failed to fetch classrooms");
                return;
            }

            const classrooms = await classroomsResponse.json();
            console.log("✅ Fetched classrooms:", classrooms);

            // Display students
            let html = '<h1>所有學生</h1>';
            classrooms.forEach(classroom => {
                html += `<h2>${classroom.name} (${classroom.students.length} students)</h2>`;
                html += '<table border="1" style="width: 100%; border-collapse: collapse;">';
                html += '<tr><th>姓名</th><th>Email</th><th>生日</th><th>密碼狀態</th></tr>';

                classroom.students.forEach(student => {
                    html += '<tr>';
                    html += `<td>${student.name}</td>`;
                    html += `<td>${student.email}</td>`;
                    html += `<td>${student.birthdate || 'N/A'}</td>`;
                    html += `<td>${student.password_changed ? '已更改' : '預設密碼 (' + (student.birthdate ? student.birthdate.replace(/-/g, '') : '') + ')'}</td>`;
                    html += '</tr>';
                });
                html += '</table><br/>';
            });

            document.getElementById('content').innerHTML = html;
        }

        window.onload = testStudentsPage;
    </script>
</head>
<body>
    <div id="content">Loading...</div>
</body>
</html>
