# GitHub Actions Workflows

## ğŸ¯ æ™ºèƒ½æª”æ¡ˆè®Šæ›´æª¢æ¸¬ CI/CD

æˆ‘å€‘çš„ CI/CD æ¶æ§‹ç¾åœ¨ä½¿ç”¨**æ™ºèƒ½æª”æ¡ˆè®Šæ›´æª¢æ¸¬**ï¼Œæ ¹æ“šè®Šæ›´çš„æª”æ¡ˆè‡ªå‹•æ±ºå®šè¦åŸ·è¡Œå“ªå€‹éƒ¨ç½²æµç¨‹ã€‚

## ğŸ“ Workflow æª”æ¡ˆèªªæ˜

### 1. `deploy-backend.yml` ğŸ”§
**è§¸ç™¼æ¢ä»¶**ï¼š
- å¾Œç«¯ç¨‹å¼ç¢¼è®Šæ›´ (`backend/**`)
- Python ä¾è³´è®Šæ›´ (`requirements*.txt`)
- è³‡æ–™åº«è¨­å®šè®Šæ›´ (`alembic.ini`)

**åŸ·è¡Œå…§å®¹**ï¼š
- Python æ¸¬è©¦ (pytest)
- Black & Flake8 æª¢æŸ¥
- è³‡æ–™åº«é·ç§» (Alembic)
- éƒ¨ç½²å¾Œç«¯åˆ° Cloud Run

### 2. `deploy-frontend.yml` ğŸ¨
**è§¸ç™¼æ¢ä»¶**ï¼š
- å‰ç«¯ç¨‹å¼ç¢¼è®Šæ›´ (`frontend/**`)
- Node è¨­å®šè®Šæ›´ (`package*.json`, `tsconfig*.json`)
- Lint è¨­å®šè®Šæ›´ (`.eslintrc*`, `.prettierrc*`)

**åŸ·è¡Œå…§å®¹**ï¼š
- TypeScript å‹åˆ¥æª¢æŸ¥
- ESLint æª¢æŸ¥
- å‰ç«¯å»ºç½®æ¸¬è©¦
- éƒ¨ç½²å‰ç«¯åˆ° Cloud Run

### 3. `deploy-shared.yml` ğŸ”„
**è§¸ç™¼æ¢ä»¶**ï¼š
- Docker è¨­å®šè®Šæ›´ (`docker-compose*.yml`)
- å…±ç”¨è¨­å®šè®Šæ›´ (`Makefile`, `.env.example`)

**åŸ·è¡Œå…§å®¹**ï¼š
- åˆ†æéœ€è¦éƒ¨ç½²çš„æœå‹™
- è‡ªå‹•è§¸ç™¼ç›¸é—œçš„ workflow
- åŸ·è¡Œå®‰å…¨æƒæ

### 4. `cleanup-resources.yml` ğŸ§¹
**è§¸ç™¼æ¢ä»¶**ï¼š
- æ¯æ—¥å®šæ™‚åŸ·è¡Œ (UTC 3:00)
- æ‰‹å‹•è§¸ç™¼

**åŸ·è¡Œå…§å®¹**ï¼š
- æ¸…ç†èˆŠçš„ Docker æ˜ åƒ
- æ¸…ç†æœªä½¿ç”¨çš„è³‡æº
- ç”¢ç”Ÿæ¸…ç†å ±å‘Š

## ğŸš€ ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šåªä¿®æ”¹å‰ç«¯
```bash
# ä¿®æ”¹å‰ç«¯å…ƒä»¶
git add frontend/src/components/Button.tsx
git commit -m "fix: Update button style"
git push

# çµæœï¼šåªè§¸ç™¼ deploy-frontend.yml
# âœ… å‰ç«¯æ¸¬è©¦ & éƒ¨ç½²
# âŒ å¾Œç«¯ä¸æœƒè¢«è§¸ç™¼ï¼ˆç¯€çœè³‡æºï¼‰
```

### ç¯„ä¾‹ 2ï¼šåªä¿®æ”¹å¾Œç«¯ API
```bash
# ä¿®æ”¹ API è·¯ç”±
git add backend/routers/users.py
git commit -m "feat: Add new user endpoint"
git push

# çµæœï¼šåªè§¸ç™¼ deploy-backend.yml
# âœ… å¾Œç«¯æ¸¬è©¦ & éƒ¨ç½²
# âœ… è³‡æ–™åº«é·ç§»æª¢æŸ¥
# âŒ å‰ç«¯ä¸æœƒè¢«è§¸ç™¼
```

### ç¯„ä¾‹ 3ï¼šåŒæ™‚ä¿®æ”¹å‰å¾Œç«¯
```bash
# åŒæ™‚ä¿®æ”¹å‰å¾Œç«¯
git add frontend/src/api/client.ts backend/main.py
git commit -m "feat: Add new feature"
git push

# çµæœï¼šå…©å€‹ workflow å¹³è¡ŒåŸ·è¡Œ
# âœ… deploy-backend.yml
# âœ… deploy-frontend.yml
# ğŸš€ éƒ¨ç½²æ™‚é–“ç¸®çŸ­ï¼ˆå¹³è¡ŒåŸ·è¡Œï¼‰
```

## ğŸ› ï¸ æ‰‹å‹•è§¸ç™¼

æ‰€æœ‰ workflow éƒ½æ”¯æ´æ‰‹å‹•è§¸ç™¼ï¼š

1. é€²å…¥ GitHub Actions é é¢
2. é¸æ“‡è¦åŸ·è¡Œçš„ workflow
3. é»æ“Š "Run workflow"
4. é¸æ“‡åˆ†æ”¯ä¸¦åŸ·è¡Œ

## ğŸ“Š æ•ˆç›Š

- **ç¯€çœ 50%+ CI/CD æ™‚é–“**ï¼šåªåŸ·è¡Œéœ€è¦çš„éƒ¨åˆ†
- **æ¸›å°‘ 60%+ è³‡æºæ¶ˆè€—**ï¼šé¿å…ä¸å¿…è¦çš„å»ºç½®
- **æ›´å¿«çš„éƒ¨ç½²é€Ÿåº¦**ï¼šå‰å¾Œç«¯å¹³è¡Œéƒ¨ç½²
- **æ›´æ¸…æ™°çš„éŒ¯èª¤è¿½è¹¤**ï¼šåˆ†é›¢çš„æ—¥èªŒå’Œç‹€æ…‹

## âš ï¸ æ³¨æ„äº‹é …

1. **è³‡æ–™åº«è®Šæ›´**ï¼šä¿®æ”¹ models æ™‚æœƒè‡ªå‹•åŸ·è¡Œ Alembic é·ç§»
2. **ç’°å¢ƒè®Šæ•¸**ï¼šæ–°å¢ç’°å¢ƒè®Šæ•¸éœ€è¦åœ¨å°æ‡‰çš„ workflow ä¸­è¨­å®š
3. **ä¾è³´é—œä¿‚**ï¼šå‰ç«¯éƒ¨ç½²æœƒè‡ªå‹•ç²å–æœ€æ–°çš„å¾Œç«¯ URL

## ğŸ”§ ç¶­è­·æŒ‡å—

### æ–°å¢è§¸ç™¼è·¯å¾‘
ç·¨è¼¯å°æ‡‰çš„ workflow æª”æ¡ˆï¼Œåœ¨ `paths` å€å¡Šæ–°å¢ï¼š
```yaml
paths:
  - 'backend/**'
  - 'new/path/**'  # æ–°å¢è·¯å¾‘
```

### æ’é™¤ç‰¹å®šæª”æ¡ˆ
ä½¿ç”¨ `paths-ignore` æ’é™¤ä¸éœ€è¦è§¸ç™¼çš„æª”æ¡ˆï¼š
```yaml
paths-ignore:
  - '**.md'
  - 'backend/tests/**'
```

## ğŸ“ æ­·å²

- **2024-12-29**: å¾å–®ä¸€ workflow é·ç§»åˆ°æ™ºèƒ½åˆ†é›¢æ¶æ§‹
- èˆŠçš„è¨­å®šæª”å‚™ä»½ç‚º `deploy-supabase.yml.old`
