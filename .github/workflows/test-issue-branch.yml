name: Test Issue Branch Pattern

on:
  push:
    branches:
      - 'fix/issue-*'
    paths:
      - 'frontend/**'
      - '!**/*.md'

env:
  PROJECT_ID: duotopia-472708
  REGION: asia-east1

jobs:
  extract:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.extract.outputs.issue_number }}
    steps:
      - name: Extract issue number
        id: extract
        run: |
          ISSUE_NUM=$(echo "${{ github.ref_name }}" | grep -oE '[0-9]+')
          echo "issue_number=$ISSUE_NUM" >> $GITHUB_OUTPUT
          echo "Issue: $ISSUE_NUM"

  test:
    runs-on: ubuntu-latest
    needs: extract
    steps:
      - name: Test output
        run: |
          echo "Branch matched! Issue #${{ needs.extract.outputs.issue_number }}"

  comment:
    runs-on: ubuntu-latest
    needs: extract
    permissions:
      issues: write
    steps:
      - uses: actions/github-script@v7
        env:
          ISSUE: ${{ needs.extract.outputs.issue_number }}
        with:
          script: |
            console.log("Would comment on issue #" + process.env.ISSUE);
            console.log("Skipping actual comment to avoid spam");
