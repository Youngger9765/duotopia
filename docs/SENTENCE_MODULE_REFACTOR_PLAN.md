# 句子模組 UI 重構計劃

## 修改範圍

本次修改**僅影響句子模組（Sentence Making）的編輯界面**，不影響朗讀評測模組。

### 影響的檔案

| 檔案 | 修改類型 |
|------|----------|
| `frontend/src/components/SentenceMakingPanel.tsx` | 主要修改 |
| `frontend/src/types/index.ts` | 新增詞性類型 |
| `backend/models.py` | 新增詞性欄位（使用 item_metadata） |
| `backend/routers/teachers.py` | 修改 AI 生成 API |

---

## 修改規格詳細說明

### 規格 1：英文單字 input 限制長度 50 字元

**現狀**：目前限制 200 字元
**修改**：改為 50 字元

```
┌────────────────────────────────────────────────────┐
│ 輸入英文單字                              (50/50)  │
└────────────────────────────────────────────────────┘
```

---

### 規格 2：英文單字與翻譯縮成同一列

**現狀**：單字和翻譯分開兩列
**修改**：合併為同一列，使用 flex-wrap 自動換行

```
桌面版 (寬度足夠):
┌─────────────────────────────────────────────────────────────────────────────┐
│  ┌──────────────────────────────┐  ┌──────────────────────────────────────┐ │
│  │ 輸入英文單字                 │  │ 輸入單字翻譯(非必填)                │ │
│  └──────────────────────────────┘  └──────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

手機版 (寬度不足，自動換行):
┌─────────────────────────────────────────────────────────────────────────────┐
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ 輸入英文單字                                                          │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ 輸入單字翻譯(非必填)                                                  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 規格 3-6：詞性選擇功能

**現狀**：無詞性功能
**修改**：新增詞性 Chip 選擇器

#### 詞性列表
| 簡寫 | 全稱 | 說明 |
|------|------|------|
| n. | noun | 名詞 |
| v. | verb | 動詞 |
| adj. | adjective | 形容詞 |
| adv. | adverb | 副詞 |
| pron. | pronoun | 代名詞 |
| prep. | preposition | 介系詞 |
| conj. | conjunction | 連接詞 |
| interj. | interjection | 感嘆詞 |
| det. | determiner | 限定詞 |
| aux. | auxiliary | 助動詞 |

#### UI 設計

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ┌────────────────────────┐  ┌────────────────────────────────────────────┐ │
│  │ apple                  │  │ 蘋果                                      │ │
│  └────────────────────────┘  └────────────────────────────────────────────┘ │
│                                                                             │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌────────┐ │
│  │ n.   │ │ v.   │ │ adj. │ │ adv. │ │ pron.│ │ prep.│ │ conj.│ │ interj.│ │
│  │ ✓    │ │      │ │      │ │      │ │      │ │      │ │      │ │        │ │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └────────┘ │
│  ┌──────┐ ┌──────┐                                                         │
│  │ det. │ │ aux. │                                                         │
│  └──────┘ └──────┘                                                         │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────┬───┐│
│  │ 輸入英文例句                                                       │AI ││
│  └────────────────────────────────────────────────────────────────────┴───┘│
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 詞性 Chip 樣式

```
未選中狀態:                  選中狀態:
┌──────────────┐            ┌──────────────┐
│     adj.     │            │     n.       │  <- 藍綠漸層背景
│              │            │              │
│  (灰色背景)  │            │  (漸層背景)  │
└──────────────┘            └──────────────┘
```

#### 自動換行示意

```
寬螢幕:
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌────────┐ ┌──────┐ ┌──────┐
│ n.   │ │ v.   │ │ adj. │ │ adv. │ │ pron.│ │ prep.│ │ conj.│ │ interj.│ │ det. │ │ aux. │
└──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └────────┘ └──────┘ └──────┘

窄螢幕 (自動換行):
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│ n.   │ │ v.   │ │ adj. │ │ adv. │ │ pron.│ │ prep.│
└──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘
┌──────┐ ┌────────┐ ┌──────┐ ┌──────┐
│ conj.│ │ interj.│ │ det. │ │ aux. │
└──────┘ └────────┘ └──────┘ └──────┘
```

#### 詞性自動選取邏輯

```
IF 使用者點擊「AI 翻譯」按鈕
  IF 詞性陣列為空 (使用者從未選擇過)
    -> AI 翻譯完成後，自動根據單字選取詞性
  ELSE (使用者已選過詞性)
    -> 保持現有詞性，不做任何修改
  END IF
END IF
```

---

### 規格 7：「批次生成例句翻譯」改名 + 批次生成流程

**現狀**：`批次生成例句翻譯`
**修改**：`批次 AI 生成例句`

#### 批次生成流程圖

```
使用者點擊「批次 AI 生成例句」
              │
              ▼
┌───────────────────────────────────────┐
│         AI 生成例句對話框              │
│  ┌─────────────────────────────────┐  │
│  │ 難度: [A1] [A2] [B1] ...        │  │
│  ├─────────────────────────────────┤  │
│  │ 給 AI 的提示: ____________      │  │
│  ├─────────────────────────────────┤  │
│  │ ☑ 翻譯成 [中文 ▼]              │  │
│  ├─────────────────────────────────┤  │
│  │ 將為 N 個有單字的項目生成例句   │  │
│  └─────────────────────────────────┘  │
│                        [取消] [生成]  │
└───────────────────────────────────────┘
              │
              │ 點擊「生成」
              ▼
┌───────────────────────────────────────┐
│  對所有有單字的項目執行：              │
│                                       │
│  1. 清空現有例句 (example_sentence)   │
│  2. 清空現有翻譯 (example_sentence_   │
│     translation) - 無論是否勾選翻譯   │
│  3. AI 生成新例句                     │
│  4. 如果勾選翻譯 → 填入新翻譯         │
│     如果未勾選翻譯 → 翻譯欄位保持空   │
└───────────────────────────────────────┘
              │
              ▼
        生成完成通知
```

#### 批次 vs 單項生成的差異

| 操作 | 影響範圍 | 行為 |
|------|----------|------|
| **批次 AI 生成例句** | 所有有單字的項目 | 全部重新生成（覆蓋現有內容） |
| **單項 AI 按鈕** | 僅該項目 | 重新生成該項目（覆蓋現有內容） |

#### 為什麼選擇「全部重新生成」？

1. **統一難度**：使用者可能想要所有例句都是同一個難度等級
2. **重複嘗試**：使用者可以用不同設定多次生成，直到滿意
3. **簡單直覺**：不需要判斷「哪些有例句、哪些沒有」的複雜邏輯
4. **翻譯一致性**：避免部分有翻譯、部分沒翻譯的不一致狀態

#### 使用者操作範例

```
場景：使用者有 5 個單字，想要 B1 難度的例句

第一次操作：
- 選擇 B1 難度
- 勾選「翻譯成中文」
- 點擊生成
- 結果：5 個單字都有 B1 例句 + 中文翻譯

第二次操作（不滿意，想換難度）：
- 選擇 A2 難度
- 取消勾選「翻譯成中文」
- 點擊生成
- 結果：5 個單字的例句被換成 A2，翻譯欄位被清空

第三次操作（想要翻譯了）：
- 選擇 A2 難度
- 勾選「翻譯成中文」
- 點擊生成
- 結果：5 個單字重新生成 A2 例句 + 中文翻譯
```

---

### 規格 8：例句輸入欄新增 AI 按鈕

**現狀**：例句輸入欄無 AI 按鈕
**修改**：右側新增 AI icon 按鈕

```
┌────────────────────────────────────────────────────────────────────────┬───┐
│ 輸入英文例句                                                           │🤖│
└────────────────────────────────────────────────────────────────────────┴───┘
                                                                          ↑
                                                                     AI 按鈕
```

---

### 規格 9：AI 生成例句對話框

點擊「批次 AI 生成例句」或單項 AI 按鈕時，彈出以下對話框：

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                                                                               │
│   AI 生成例句                                                           [X]  │
│                                                                               │
│   ─────────────────────────────────────────────────────────────────────────   │
│                                                                               │
│   難度等級                                                                    │
│   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          │
│   │   A1   │ │   A2   │ │   B1   │ │   B2   │ │   C1   │ │   C2   │          │
│   │   ✓    │ │        │ │        │ │        │ │        │ │        │          │
│   └────────┘ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘          │
│                                                                               │
│   給 AI 的提示 (選填)                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                         │ │
│   │  例如：請生成與日常生活相關的例句                                       │ │
│   │                                                                         │ │
│   │                                                                         │ │
│   └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                               │
│   ☑ 翻譯成  ┌─────────────┐                                                  │
│             │ 中文      ▼ │                                                  │
│             └─────────────┘                                                  │
│             選項：中文 / 日文 / 韓文                                          │
│                                                                               │
│                                               ┌────────────────────────────┐ │
│                                               │          生成              │ │
│                                               └────────────────────────────┘ │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

#### 難度等級 Chip 樣式

```
未選中:                      選中 (A1):
┌──────────┐                ┌──────────┐
│    B1    │                │    A1    │  <- 藍綠漸層背景
│          │                │          │
│ (灰背景) │                │ (漸層)   │
└──────────┘                └──────────┘
```

#### 翻譯語言選項

| 選項 | 說明 |
|------|------|
| 中文 | 繁體中文 (Traditional Chinese) |
| 日文 | 日語 (Japanese) |
| 韓文 | 韓語 (Korean) |

---

## 完整單字項目 UI 結構圖

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│  ┌─┐                                                                                │
│  │⋮│  拖曳手把                                                                       │
│  └─┘                                                                                │
│      ┌────────────────────────────────┐  ┌──────────────────────────────────────┐   │
│  1   │ apple                    (5/50)│  │ 蘋果                                 │   │
│      └────────────────────────────────┘  └──────────────────────────────────────┘   │
│                                                                                     │
│      ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌────────┐     │
│      │ n.   │ │ v.   │ │ adj. │ │ adv. │ │ pron.│ │ prep.│ │ conj.│ │ interj.│     │
│      │ ✓    │ │      │ │      │ │      │ │      │ │      │ │      │ │        │     │
│      └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └────────┘     │
│      ┌──────┐ ┌──────┐                                                             │
│      │ det. │ │ aux. │                                                             │
│      └──────┘ └──────┘                                                             │
│                                                                                     │
│      ┌────────────────────────────────────────────────────────────────────────┬───┐│
│      │ This is a delicious apple.                                             │🤖 ││
│      └────────────────────────────────────────────────────────────────────────┴───┘│
│                                                                                     │
│      ┌────────────────────────────────────────────────────────────────────────────┐│
│      │ 這是一顆美味的蘋果。                                                       ││
│      └────────────────────────────────────────────────────────────────────────────┘│
│                                                                                     │
│      ┌───┐ ┌───┐ ┌───┐                                             ┌───┐ ┌───┐    │
│      │ ▶ │ │🎤│ │ ✕ │  音檔控制                                     │📋│ │🗑│     │
│      └───┘ └───┘ └───┘                                             └───┘ └───┘    │
│       播放  錄音  移除                                               複製  刪除    │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 批次操作按鈕區域

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌────────────────────┐         │
│  │ 批次新增單字 │ │ 批次生成語音 │ │ 批次單字翻譯 │ │  批次 AI 生成例句  │         │
│  │    (藍色)    │ │    (黃色)    │ │    (綠色)    │ │      (紫色)        │         │
│  └──────────────┘ └──────────────┘ └──────────────┘ └────────────────────┘         │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 資料結構修改

### 前端 ContentRow 介面修改

```typescript
interface ContentRow {
  id: string | number;
  text: string;                              // 英文單字 (max 50 chars)
  definition: string;                        // 中文翻譯
  translation?: string;                      // 英文釋義
  partsOfSpeech?: string[];                  // 詞性陣列 (新增)
  // ... 其他欄位
}
```

### 詞性儲存方式

使用現有的 `item_metadata` JSON 欄位儲存：

```json
{
  "parts_of_speech": ["n.", "v."],
  "chinese_translation": "蘋果",
  "english_definition": "a round fruit..."
}
```

---

## 待確認問題

### 問題 1：難度等級是否為單選？

從圖片看起來是單選（只有 A1 被選中），請確認是否：
- **單選**：只能選一個難度
- **複選**：可以選多個難度

**我的理解**：單選，每次生成只能選擇一個難度等級。

### 問題 2：「翻譯成」的 checkbox 行為？

如果 checkbox 未勾選，是否：
- **不翻譯**：只生成英文例句，不翻譯
- **預設勾選**：checkbox 預設勾選

**我的理解**：checkbox 預設勾選，取消勾選則只生成英文例句。

### 問題 3：批次 vs 單項生成的差異？

- **批次 AI 生成例句**：為所有沒有例句的項目生成
- **單項 AI 按鈕**：只為該項目生成

兩者是否共用同一個對話框？

**我的理解**：是，共用同一個對話框，差異只在於生成的範圍。

### 問題 4：詞性的儲存與顯示？

詞性是否需要在學生端（練習時）顯示？還是只在編輯時使用？

**我的理解**：需要在學生端顯示，因為詞性是學習重要資訊。

### 問題 5：現有例句翻譯欄位的處理？

現有的「例句翻譯(非必須)」欄位是否保留？新的 AI 生成翻譯是否會填入此欄位？

**我的理解**：保留，AI 生成的翻譯會填入此欄位。

---

## 實作順序建議

1. **Phase 1：UI 調整（不涉及 AI 邏輯）**
   - 規格 1：英文單字長度限制 50 字元
   - 規格 2：單字與翻譯合併同一列
   - 規格 3-6：新增詞性選擇 Chip
   - 規格 7：按鈕改名

2. **Phase 2：AI 生成對話框**
   - 規格 8：例句輸入欄新增 AI 按鈕
   - 規格 9：AI 生成例句對話框

3. **Phase 3：後端 API 修改**
   - 修改 AI 生成 API 支援難度、prompt、翻譯語言
   - 詞性自動識別邏輯

---

請確認以上規格理解是否正確，以及回答待確認的問題後，我會開始實作。
