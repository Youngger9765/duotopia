# Duotopia 11月交付功能清單

**版本**: 2.0
**日期**: 2025-11-18
**狀態**: ✅ 核心功能已完成

---

## 📋 功能交付總覽

### ✅ 已完成功能 (5項)
1. ✅ 後台顯示試用方案資訊
2. ✅ 試用點數自動轉移
3. ✅ 後台帳款資料下載
4. ✅ 每月自動續訂機制
5. ✅ 信用卡綁定流程

### ❌ 未包含功能 (2項)
- ❌ 退款機制（不在本次需求範圍）
- ❌ 多語言介面（不在本次需求範圍）

---

## 📦 功能詳細說明

### 1️⃣ 後台顯示試用方案資訊

**✅ 已完成**

#### 功能說明
管理者在後台可以看到新註冊用戶的試用方案資訊。

#### 具體內容
- 試用方案顯示為「30-Day Trial」
- 顯示試用到期日（註冊日 + 30天）
- 付費用戶顯示對應方案名稱

---

### 2️⃣ 試用點數自動轉移

**✅ 已完成**

#### 功能說明
當用戶從試用升級到付費方案時，未使用的試用點數會自動加到付費方案中。

#### 舉例
```
用戶試用期：
- 獲得 10,000 點試用點數
- 已使用 3,000 點
- 剩餘 7,000 點

升級到 School Teachers 方案：
- School 方案基本配額：25,000 點
- 加上試用剩餘：7,000 點
- 總配額：32,000 點
```

#### 好處
- 用戶不會損失未使用的試用點數
- 提升付費轉換意願

---

### 3️⃣ 後台帳款資料下載

**✅ 已完成**

#### 功能說明
管理者可以下載訂閱資料、交易記錄、學習數據為 Excel 檔案。

#### 具體內容
- 可選擇日期範圍
- 下載為 CSV 格式（Excel 可直接開啟）
- 支援中文欄位名稱
- 檔名自動加上下載日期

#### 可下載的資料
1. 訂閱資料（用戶方案、到期日等）
2. 交易記錄（付款日期、金額等）
3. 學習分析（使用點數、活動記錄等）

---

### 4️⃣ 每月自動續訂機制

**✅ 已完成**

#### 功能說明
每個月 1 號凌晨 2 點，系統自動處理訂閱續約。

#### 自動執行的事項

**1. 標記過期訂閱**
- 檢查所有到期的訂閱
- 自動標記為「已過期」

**2. 自動續訂**
符合以下條件的用戶會自動續訂：
- 用戶有開啟「自動續訂」
- 用戶有綁定信用卡
- 帳號為啟用狀態

**3. 安全機制**
- 防止重複扣款（已有本月訂閱就跳過）
- 防止錯誤扣款（檢查是否有上個月的訂閱記錄）
- 如有異常，自動關閉續訂功能並通知用戶

#### 待處理事項
- [ ] 設定每月 1 號自動觸發
- [ ] 完成 Email 通知模板

---

### 5️⃣ 信用卡綁定流程

**✅ 已完成**

#### 功能說明
用戶綁定信用卡時，可以選擇是否啟用自動續訂。

#### 三種使用情境

**情境 1：綁定信用卡**
```
1. 用戶輸入信用卡資訊
2. 系統驗證成功
3. 詢問：「是否啟用自動續訂？」
   - 選「是」→ 每月 1 號自動扣款續訂
   - 選「否」→ 保留信用卡但需手動續訂
```

**情境 2：刪除信用卡**
```
1. 用戶刪除信用卡
2. 系統提示：「刪除後自動續訂將關閉」
3. 確認後：
   - 信用卡資訊刪除
   - 自動續訂功能自動關閉
```

**情境 3：只關閉自動續訂**
```
1. 用戶關閉自動續訂開關
2. 系統提示：「關閉後不會自動扣款，可隨時手動續訂」
3. 確認後：
   - 自動續訂關閉
   - 信用卡資訊保留（方便未來手動付款）
```

#### 保護機制
- 沒有綁定信用卡，無法開啟自動續訂
- 系統會阻止不合理的設定

---

## 📊 訂閱方案配額

### 試用方案 (30-Day Trial)
- **配額**: 10,000 點
- **期限**: 30 天
- **費用**: 免費

### Tutor Teachers
- **配額**: 10,000 點/月
- **費用**: NT$ 231/月

### School Teachers
- **配額**: 25,000 點/月
- **費用**: NT$ 660/月

---

## ✅ 完成度總結

### 核心業務功能：100% 完成 ✅
所有案主要求的功能都已完成並上線：
1. ✅ 後台試用方案顯示
2. ✅ 試用點數轉移
3. ✅ 後台資料下載
4. ✅ 自動續訂機制
5. ✅ 信用卡綁定流程

### 待完成事項
- [ ] 設定每月自動續訂排程（需 GCP 設定）
- [ ] 測試第一次自動續訂執行

---

**文件版本**: 2.0（案主版）
**最後更新**: 2025-11-18
**狀態**: ✅ 所有功能已上線
