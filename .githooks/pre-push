#!/bin/bash
# Pre-push hook - åœ¨ push å‰åŸ·è¡Œå®Œæ•´æ¸¬è©¦

echo "ğŸš€ åŸ·è¡Œ pre-push æª¢æŸ¥..."

# ç²å–è¦æ¨é€çš„åˆ†æ”¯
branch=$(git rev-parse --abbrev-ref HEAD)
echo "ğŸ“ æº–å‚™æ¨é€åˆ°åˆ†æ”¯: $branch"

# TypeScript æª¢æŸ¥
echo "ğŸ“ åŸ·è¡Œ TypeScript æª¢æŸ¥..."
npm run typecheck
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript æª¢æŸ¥å¤±æ•—ï¼è«‹ä¿®æ­£éŒ¯èª¤å¾Œå†æ¨é€ã€‚"
    exit 1
fi

# å»ºç½®æ¸¬è©¦
echo "ğŸ”¨ åŸ·è¡Œå»ºç½®æ¸¬è©¦..."
npm run build
if [ $? -ne 0 ]; then
    echo "âŒ å»ºç½®å¤±æ•—ï¼è«‹ä¿®æ­£éŒ¯èª¤å¾Œå†æ¨é€ã€‚"
    exit 1
fi

# å¾Œç«¯æ¸¬è©¦ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
if [ -d "backend/tests" ]; then
    echo "ğŸ§ª åŸ·è¡Œå¾Œç«¯æ¸¬è©¦..."
    cd backend
    python -m pytest tests/ -v || true
    cd ..
fi

echo "âœ… æ‰€æœ‰æª¢æŸ¥é€šéï¼ç¹¼çºŒæ¨é€..."