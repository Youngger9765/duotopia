#!/bin/bash
#================================================================
# Git Post-Push Hook
# Automatically monitors deployment after pushing to remote
#================================================================

# ç²å–ç•¶å‰åˆ†æ”¯
BRANCH=$(git rev-parse --abbrev-ref HEAD)

# åªåœ¨ staging æˆ– main åˆ†æ”¯åŸ·è¡Œç›£æ§
if [[ "$BRANCH" == "staging" ]] || [[ "$BRANCH" == "main" ]]; then
    echo "ğŸš€ Starting deployment monitor for branch: $BRANCH"

    # åŸ·è¡Œç›£æ§è…³æœ¬ï¼ˆèƒŒæ™¯åŸ·è¡Œï¼Œä¸é˜»å¡ï¼‰
    if [ -f "./scripts/monitor-deployment.sh" ]; then
        ./scripts/monitor-deployment.sh "$BRANCH" &
        echo "ğŸ“Š Monitor running in background. PID: $!"
        echo "ğŸ’¡ View live at: https://github.com/Youngger9765/duotopia/actions"
    else
        echo "âš ï¸  Monitor script not found at ./scripts/monitor-deployment.sh"
    fi
else
    echo "â„¹ï¸  Branch '$BRANCH' does not trigger deployment monitoring"
fi
