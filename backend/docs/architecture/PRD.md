# Duotopia 平台產品需求文件 (PRD)

## 1. 概述

Duotopia 是一個全方位的教育管理平台，支援機構和個體教師的教學活動管理。平台採用雙體系架構，同時服務於學校機構和獨立教師，提供班級管理、課程設計、活動建立、作業分配和成績追蹤等功能。

## 2. 現有功能模組

### 2.1 個體教師端功能 (Individual Teacher Portal) ✅ 已完成

#### 核心功能
- **教師註冊與登入**: Google OAuth 2.0 快速註冊登入
- **角色切換**: 支援在機構教師和個體教師間切換（需有對應權限）

#### 班級管理 (Classroom Management)
- **建立班級** (`POST /api/individual/classrooms`): 創建新班級，設定名稱、年級、容量
- **班級列表** (`GET /api/individual/classrooms`): 查看所有班級，顯示學生人數
- **班級詳情** (`GET /api/individual/classrooms/{id}`): 查看單一班級完整資訊
- **更新班級** (`PUT /api/individual/classrooms/{id}`): 修改班級資訊
- **刪除班級** (`DELETE /api/individual/classrooms/{id}`): 軟刪除班級

#### 學生管理 (Student Management)
- **新增學生** (`POST /api/individual/students`): 
  - 必填：姓名、生日
  - 選填：Email、推薦人、學習目標
  - 預設密碼：生日 (YYYYMMDD)
- **學生列表** (`GET /api/individual/students`): 
  - 顯示學生資料、所屬班級狀態、密碼狀態
  - 支援搜尋功能
- **批量匯入** (`POST /api/individual/students/import`): Excel/CSV 批量匯入
- **分配班級** (`POST /api/individual/classrooms/{id}/students`): 將學生加入班級
- **密碼管理**:
  - 查看密碼狀態（預設/自訂）
  - 重置密碼 (`POST /api/individual/students/{id}/reset-password`)
  - 顯示預設密碼並提供複製功能

#### 課程管理 (Course Management)
- **建立課程** (`POST /api/individual/courses`): 創建新課程
- **課程列表** (`GET /api/individual/courses`): 三欄式介面
  - 左欄：課程列表
  - 中欄：課程單元列表
  - 右欄：單元內容詳情
- **新增單元** (`POST /api/individual/courses/{id}/lessons`): 
  - 支援多種活動類型
  - 可設定順序、標題、說明
- **單元管理**:
  - 編輯單元內容
  - 預覽單元
  - 刪除單元
  - 調整順序

#### 特色功能
- **教室容量管理**: 防止超收學生
- **密碼安全**: 教師只能看到學生是否使用預設密碼，無法查看自訂密碼
- **靈活的學生資料**: Email 為選填，適應不同年齡層學生

### 2.2 機構教師端功能 (Institutional Teacher Portal)

[待實作]

### 2.3 管理端功能 (Admin Portal)

[待實作]
- **學校管理**: 新增、編輯、刪除學校資料
- **教職員管理**: 管理教師和職員帳號
- **學生管理**: 學生資料維護、班級分配
- **系統設定**: 平台層級的設定管理

### 2.4 學生端功能 (Student Portal) ✅ 已完成

#### 學生登入與驗證機制
- **四步驟登入流程**:
  1. 輸入老師 Email
  2. 選擇班級
  3. 選擇自己的姓名
  4. 輸入密碼（預設為生日 YYYYMMDD 格式）
- **開發環境輔助**: 登入頁面顯示測試帳號小抄（僅開發環境）

#### 學生-老師關係規範 (SPEC)
- **多對多關係**: 一個學生可以屬於多個老師，一個老師可以有多個學生
- **獨立驗證**: 學生要進入任何老師的教室都需要先通過該老師的密碼驗證
- **單一會話**: 學生一次只能進入一個老師的教學環境
- **會話切換**: 要切換到其他老師需要重新走完整登入流程
- **密碼獨立性**: 同一學生在不同老師底下可以有不同的密碼

#### 學生儀表板功能
- **側邊欄顯示**:
  - 當前登入學生姓名和 Email
  - 當前老師資訊
  - 導航選單：我的課程、作業、學習進度、設定
- **首頁總覽**: 顯示本週作業、已完成數量、學習時數
- **響應式設計**: 支援手機和平板瀏覽

#### 密碼管理功能
- **密碼狀態顯示**: 標示是否使用預設密碼
- **修改密碼** (`POST /api/student-login/change-password`):
  - 驗證當前密碼
  - 設定新密碼（至少4個字符）
  - 更新後自動標記為自訂密碼
- **切換老師**: 提供快速切換到其他老師的入口（需重新登入）

#### 未來功能規劃
- **課程瀏覽**: 查看當前老師分配的課程
- **作業提交**: 完成並提交當前老師的作業
- **成績查詢**: 查看在當前老師底下的成績記錄
- **學習進度**: 追蹤在當前老師底下的學習狀況

## 3. 活動系統架構

### 3.1 核心概念

- **班級 (Class)** → **課程 (Course)** → **活動 (Activity)**
- 每個活動可以是不同類型，具有特定的內容結構和評分邏輯
- 活動系統需要支援現有和未來的各種活動形式

### 3.2 活動類型

#### 現有活動類型
- 聽力克漏字 (Listening Cloze)
- 口說錄音 (Speaking Record)
- 閱讀理解 (Reading Comprehension)
- 寫作任務 (Writing Task)
- 混合題組 (Mixed Question Set)

#### 設計原則
- 可擴展性：輕鬆新增新活動類型
- 統一介面：所有活動共享基礎結構
- 靈活配置：每種活動有專屬配置格式

## 4. 資料模型設計

### 4.1 活動主表 (Activities)

儲存所有活動的基本資訊：
- 基本資訊：標題、描述、類型
- 配置資料：JSON 格式儲存活動特定配置
- 設定選項：時間限制、重試次數、計分方式
- 狀態管理：草稿、已發布、已歸檔
- 時間控制：開始時間、截止時間

### 4.2 活動內容表 (Activity Contents)

儲存活動的具體內容：
- 內容類型：題目、音檔、影片、文字、圖片
- 順序控制：支援多個內容項目的排序
- 內容資料：JSON 格式儲存不同類型的內容

### 4.3 學生提交表 (Student Submissions)

記錄學生的作答資料：
- 提交資料：答案、錄音檔案路徑等
- 評分資料：分數、滿分、詳細回饋
- 狀態追蹤：進行中、已提交、已評分
- 時間記錄：開始時間、提交時間、評分時間

## 5. 活動處理架構

### 5.1 策略模式設計

每種活動類型有對應的處理器：
- 配置驗證：確保活動配置正確
- 提交處理：處理學生答案
- 分數計算：根據活動規則計算成績
- 回饋生成：產生詳細的評分回饋

### 5.2 工廠模式

活動處理器工廠根據活動類型返回對應的處理器，實現動態處理邏輯。

## 6. 前端架構

### 6.1 動態渲染系統

- 活動渲染器：根據活動類型動態載入對應元件
- 統一介面：所有活動元件實作相同的介面
- 狀態管理：統一管理作答進度和提交狀態

### 6.2 元件化設計

每種活動類型對應一個專門的 React 元件，包含：
- 活動呈現邏輯
- 使用者互動處理
- 資料收集和驗證
- 提交前預覽

## 7. API 設計

### 7.1 活動管理 API

- 建立活動：驗證配置並儲存
- 更新活動：修改活動資訊和配置
- 刪除活動：軟刪除或歸檔
- 發布活動：更改活動狀態

### 7.2 學生作答 API

- 開始活動：記錄開始時間
- 儲存進度：自動儲存作答進度
- 提交答案：處理並評分
- 查看結果：獲取評分和回饋

## 8. 擴展性考量

### 8.1 新增活動類型流程

1. 定義活動配置結構
2. 實作對應的處理器
3. 開發前端展示元件
4. 註冊到系統中

### 8.2 版本管理

- 活動配置包含版本資訊
- 支援舊版本活動的相容性
- 提供升級機制

## 9. 成績與報表

### 9.1 成績管理

- 即時評分：自動評分的活動立即顯示成績
- 人工評分：支援教師手動評分和批註
- 成績統計：班級、個人的成績分析

### 9.2 報表功能

- 活動完成率
- 平均分數統計
- 常錯題分析
- 學習進度追蹤

## 10. 未來擴展方向

### 10.1 AI 輔助功能

- 智慧評分：AI 輔助作文評分
- 發音評估：口說活動的自動評分
- 個人化推薦：根據學習狀況推薦活動

### 10.2 協作功能

- 小組活動：支援多人協作完成
- 同儕互評：學生互相評分和回饋
- 即時互動：線上即時答題競賽

## 11. 技術優勢

1. **高擴展性**：新活動類型易於添加
2. **資料彈性**：JSON 結構適應各種需求
3. **統一管理**：所有活動共用基礎架構
4. **關注分離**：內容、邏輯、展示分離
5. **版本控制**：支援活動格式演進

## 12. 實施階段

### Phase 1：基礎架構 ✅ 已完成
- 建立雙體系資料模型（個體/機構）
- 實作核心 API 架構
- 開發前端基礎框架

### Phase 2：個體教師功能 ✅ 已完成
- 完成個體教師所有功能
- 實作學生登入和管理系統
- 建立班級和課程管理功能
- 整合密碼管理和安全機制

### Phase 3：機構功能（進行中）
- 實作機構教師功能
- 開發機構管理介面
- 整合機構和個體系統

### Phase 4：活動系統（待開發）
- 實作 3-5 種常用活動類型
- 建立對應的前端元件
- 測試和優化

### Phase 5：進階功能（未來規劃）
- 加入 AI 評分功能
- 開發報表系統
- 實作協作功能

## 13. 完成進度總覽

### ✅ 已完成功能
1. **個體教師端**
   - Google OAuth 登入
   - 班級管理（CRUD）
   - 學生管理（含批量匯入）
   - 課程管理（三欄式介面）
   - 密碼管理系統

2. **學生端**
   - 四步驟登入流程
   - 學生儀表板
   - 密碼修改功能
   - 老師切換機制

3. **系統架構**
   - 雙體系資料模型
   - API 認證和授權
   - 前後端分離架構
   - 測試框架組織

### 🚧 進行中
- 機構教師功能
- 機構管理介面

### 📋 待開發
- 活動系統
- 作業管理
- 成績報表
- AI 輔助功能