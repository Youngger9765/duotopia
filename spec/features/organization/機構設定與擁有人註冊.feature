# language: zh-TW
功能: 機構設定與擁有人註冊
  作為 Duotopia 專案擁有人
  我希望能在付款完成後設定機構並指派機構擁有人
  以便機構能夠開始運作

  背景:
    假設 我是 Duotopia 專案擁有人
    而且 機構 "ABC 教育集團" 的合約付款已完成
    而且 訂閱已開通

  規則: 新增機構並設定擁有人 - 擁有人已是網站會員
    
    場景: 機構擁有人已註冊為網站會員
      假設 用戶 "wang@abc.edu.tw" 已註冊為網站會員
      而且 用戶已完成 Email 驗證
      當 我新增機構 "ABC 教育集團"
      而且 我設定以下機構資訊:
        | 欄位         | 值                  |
        | 機構名稱     | ABC 教育集團        |
        | 統編         | 12345678           |
        | 擁有人姓名   | 王小明              |
        | 擁有人 Email | wang@abc.edu.tw    |
        | 擁有人手機   | 0912345678         |
        | 教師授權總數 | 10                 |
        | 總點數       | 117000             |
      而且 我指派 "林服務" 為專案服務人員
      那麼 機構應成功建立
      而且 機構擁有人應設定為 "wang@abc.edu.tw"
      而且 "wang@abc.edu.tw" 應獲得 "org_owner" 角色
      而且 專案服務人員應設定為 "林服務"
      而且 "林服務" 應獲得 "org_admin" 角色
      而且 機構狀態應為 "啟用"
  
  規則: 新增機構並設定擁有人 - 擁有人尚未註冊
    
    場景: 機構擁有人尚未註冊為網站會員
      假設 用戶 "chen@xyz.edu.tw" 尚未註冊為網站會員
      當 我新增機構 "XYZ 教育集團"
      而且 我設定以下機構資訊:
        | 欄位         | 值                  |
        | 機構名稱     | XYZ 教育集團        |
        | 統編         | 87654321           |
        | 擁有人姓名   | 陳小華              |
        | 擁有人 Email | chen@xyz.edu.tw    |
        | 擁有人手機   | 0987654321         |
        | 教師授權總數 | 15                 |
        | 總點數       | 200000             |
      那麼 應偵測到 "chen@xyz.edu.tw" 尚未註冊
      而且 應顯示 "發送認證信" 按鈕
    
    場景: 為未註冊的機構擁有人發送認證信
      假設 用戶 "chen@xyz.edu.tw" 尚未註冊為網站會員
      而且 我已新增機構 "XYZ 教育集團"
      而且 機構擁有人設定為 "chen@xyz.edu.tw"
      當 我點擊 "發送認證信" 按鈕
      那麼 應建立教師帳號 "chen@xyz.edu.tw"
      而且 應產生一次性設定密碼 token
      而且 token 有效期限應為 "24" 小時
      而且 應發送認證信至 "chen@xyz.edu.tw"
      而且 認證信應包含設定密碼連結（含 token）
      而且 "chen@xyz.edu.tw" 應獲得 "org_owner" 角色
      而且 帳號狀態應為 "待設定密碼"
  
  規則: 機構擁有人收到認證信後完成註冊
    
    場景: 機構擁有人點擊設定密碼連結
      假設 機構擁有人 "chen@xyz.edu.tw" 已收到認證信
      而且 認證信包含有效的設定密碼 token
      當 機構擁有人點擊設定密碼連結
      那麼 應顯示設定密碼頁面
      而且 應要求輸入新密碼
      而且 應要求確認新密碼
    
    場景: 機構擁有人設定密碼成功
      假設 機構擁有人 "chen@xyz.edu.tw" 已開啟設定密碼頁面
      而且 設定密碼 token 有效
      當 機構擁有人輸入新密碼 "MySecure@Pass123"
      而且 確認密碼為 "MySecure@Pass123"
      而且 點擊 "設定密碼" 按鈕
      那麼 密碼應設定成功
      而且 token 應失效
      而且 帳號狀態應變更為 "已驗證"
      而且 應自動登入
      而且 應進入機構管理後台
    
    場景: 設定密碼 token 已過期
      假設 機構擁有人 "chen@xyz.edu.tw" 已收到認證信
      而且 設定密碼 token 已超過 "24" 小時
      當 機構擁有人點擊設定密碼連結
      那麼 應顯示錯誤訊息 "設定密碼連結已過期"
      而且 應提供 "重新發送認證信" 按鈕
  
  規則: 機構擁有人登入後台
    
    場景: 已註冊的機構擁有人首次登入
      假設 機構擁有人 "wang@abc.edu.tw" 已完成驗證
      而且 機構擁有人已被設定為 "ABC 教育集團" 的擁有人
      當 機構擁有人訪問 "https://duotopia.co/teacher/login"
      而且 機構擁有人使用 "wang@abc.edu.tw" 登入
      那麼 應成功登入
      而且 應進入機構管理後台
      而且 應顯示 "ABC 教育集團" 的機構資訊
      而且 應顯示教師授權數: "已使用 0 / 總數 10"
      而且 應顯示剩餘點數: "117000 點"
    
    場景: 未註冊的機構擁有人完成設定密碼後登入
      假設 機構擁有人 "chen@xyz.edu.tw" 已完成密碼設定
      而且 設定密碼為 "MySecure@Pass123"
      而且 機構擁有人已被設定為 "XYZ 教育集團" 的擁有人
      當 機構擁有人訪問 "https://duotopia.co/teacher/login"
      而且 機構擁有人使用 "chen@xyz.edu.tw" 和 "MySecure@Pass123" 登入
      那麼 應成功登入
      而且 應進入機構管理後台
      而且 應顯示 "XYZ 教育集團" 的機構資訊
  
  規則: 設定專案服務人員
    
    場景: 指派專案服務人員為機構管理人
      假設 機構 "ABC 教育集團" 已建立
      而且 Duotopia 員工 "林服務" 已註冊
      當 我指派 "林服務" 為專案服務人員
      那麼 "林服務" 應獲得 "org_admin" 角色
      而且 "林服務" 應能訪問 "ABC 教育集團" 的機構後台
      而且 "林服務" 應能協助管理機構
