# language: zh-TW
功能: AI 輔助新增機構資料
  作為 機構擁有人或機構管理人
  我希望能透過 AI 對話框輔助新增學校、教師、班級、學生資料
  以便快速完成機構初始設定或日常資料維護

  背景:
    假設 我是機構 "ABC 教育集團" 的擁有人
    而且 我已登入機構管理後台
    而且 我在「資料管理」頁面

  規則: AI 對話框介面初始狀態
    
    場景: 進入資料管理頁面看到 AI 對話框
      當 我進入「資料管理」頁面
      那麼 我應看到 AI 對話框
      而且 AI 對話框應顯示歡迎訊息
      而且 AI 對話框應顯示四個引導按鈕:
        | 按鈕文字         | 圖示 |
        | 新增學校         | 🏫   |
        | 新增機構教師     | 👨‍🏫   |
        | 新增學校班級     | 📚   |
        | 新增班級學生     | 👨‍🎓   |
      而且 AI 對話框應顯示 "📊 Excel 批次上傳" 選項
    
    場景: 所有引導按鈕都可點擊
      當 我進入「資料管理」頁面
      那麼 所有引導按鈕應為可點擊狀態
      而且 不應因資料未建立而停用按鈕

  規則: 點擊引導按鈕後顯示輸入方式選項
    
    場景: 點擊「新增學校」按鈕顯示輸入選項
      假設 我在 AI 對話框頁面
      當 我點擊 "新增學校" 按鈕
      那麼 AI 應回覆: "您要如何新增學校資料？"
      而且 AI 應顯示三個輸入方式選項:
        | 選項文字           | 圖示 | 說明       |
        | 填寫表單（快速）   | 📝   | 適合單筆   |
        | 對話輸入（彈性）   | 💬   | 自然語言   |
        | Excel 上傳（批次）| 📊   | 適合多筆   |
    
    場景: 點擊「新增機構教師」按鈕顯示輸入選項
      假設 我在 AI 對話框頁面
      當 我點擊 "新增機構教師" 按鈕
      那麼 AI 應回覆: "您要如何新增機構教師資料？"
      而且 AI 應顯示三個輸入方式選項
    
    場景: 點擊「新增學校班級」但尚未建立學校
      假設 機構尚未建立任何學校
      當 我點擊 "新增學校班級" 按鈕
      那麼 AI 應提示: "目前還沒有學校，是否要先新增學校？"
      而且 AI 應顯示兩個選項:
        | 選項文字     |
        | 先新增學校   |
        | 繼續新增班級 |
    
    場景: 點擊「新增班級學生」但尚未建立班級
      假設 機構尚未建立任何班級
      當 我點擊 "新增班級學生" 按鈕
      那麼 AI 應提示: "目前還沒有班級，是否要先新增學校和班級？"
      而且 AI 應顯示引導建立流程的選項

  規則: 填寫表單模式 - 新增學校
    
    場景: 選擇填寫表單方式新增學校
      假設 我點擊了 "新增學校" 按鈕
      當 我選擇 "填寫表單（快速）"
      那麼 AI 應顯示學校資料表單
      而且 表單應包含以下欄位:
        | 欄位名稱   | 是否必填 |
        | 學校名稱   | 是       |
        | 聯絡電話   | 否       |
        | 聯絡信箱   | 否       |
        | 地址       | 否       |
      而且 表單應有 "確認新增" 按鈕
      而且 表單應有 "取消" 按鈕
    
    場景: 填寫表單後確認新增學校
      假設 我在學校資料表單頁面
      當 我填寫以下資訊:
        | 欄位名稱   | 值                      |
        | 學校名稱   | 台北分校                |
        | 聯絡電話   | 02-12345678            |
        | 地址       | 台北市中正區某某路123號  |
      而且 我點擊 "確認新增" 按鈕
      那麼 AI 應顯示確認摘要: "您要新增的學校資訊如下：【學校名稱：台北分校、聯絡電話：02-12345678、地址：台北市中正區某某路123號】，確認新增嗎？"
      而且 AI 應顯示 "確認" 和 "修改" 按鈕
    
    場景: 確認後成功新增學校
      假設 AI 已顯示學校資訊確認摘要
      當 我點擊 "確認" 按鈕
      那麼 學校應成功建立
      而且 AI 應顯示: "✅ 已成功新增「台北分校」"
      而且 AI 應詢問: "是否要繼續新增其他資料？"
      而且 AI 應重新顯示四個引導按鈕

  規則: 對話輸入模式 - 新增學校
    
    場景: 選擇對話輸入方式新增學校
      假設 我點擊了 "新增學校" 按鈕
      當 我選擇 "對話輸入（彈性）"
      那麼 AI 應引導: "請告訴我學校的相關資訊，例如學校名稱、聯絡方式等"
      而且 AI 應等待我輸入自然語言
    
    場景: 用自然語言描述學校資訊
      假設 我選擇了對話輸入方式
      當 我輸入: "台北分校，電話是02-12345678，在台北市中正區某某路123號"
      那麼 AI 應解析我的輸入
      而且 AI 應顯示解析結果:
        | 欄位名稱   | 解析值                  |
        | 學校名稱   | 台北分校                |
        | 聯絡電話   | 02-12345678            |
        | 地址       | 台北市中正區某某路123號  |
      而且 AI 應詢問: "以上資訊正確嗎？"
      而且 AI 應顯示 "確認新增" 和 "修改" 按鈕
    
    場景: 對話輸入缺少必填欄位
      假設 我選擇了對話輸入方式
      當 我輸入: "電話是02-12345678"
      那麼 AI 應提示: "我需要知道學校名稱才能新增，請問學校名稱是什麼？"
      而且 AI 應等待我補充資訊

  規則: Excel 批次上傳 - 新增學校
    
    場景: 選擇 Excel 上傳方式新增學校
      假設 我點擊了 "新增學校" 按鈕
      當 我選擇 "Excel 上傳（批次）"
      那麼 AI 應顯示: "請上傳學校資料 Excel 檔案"
      而且 AI 應提供 "下載範本" 連結
      而且 AI 應顯示檔案上傳區域
    
    場景: 提供標準 Excel 範本下載
      假設 我在 Excel 上傳頁面
      當 我點擊 "下載範本" 連結
      那麼 應下載 "學校資料範本.xlsx" 檔案
      而且 範本應包含以下欄位作為標題列:
        | 欄位名稱   |
        | 學校名稱   |
        | 聯絡電話   |
        | 聯絡信箱   |
        | 地址       |
      而且 範本應包含範例資料行
    
    場景: 上傳 Excel 後顯示預覽
      假設 我在 Excel 上傳頁面
      而且 我準備了包含 "3" 筆學校資料的 Excel 檔案
      當 我上傳 Excel 檔案
      那麼 AI 應自動解析 Excel 內容
      而且 AI 應顯示: "已解析 3 筆學校資料，請確認以下資訊："
      而且 AI 應以表格形式顯示所有資料
      而且 每筆資料應可編輯
      而且 AI 應顯示 "確認匯入" 和 "取消" 按鈕
    
    場景: 確認後批次匯入學校資料
      假設 AI 已顯示 Excel 資料預覽表格
      而且 預覽表格有 "3" 筆學校資料
      當 我點擊 "確認匯入" 按鈕
      那麼 應批次建立 "3" 所學校
      而且 AI 應顯示: "✅ 已成功匯入 3 所學校"
      而且 AI 應列出新增的學校名稱
    
    場景: Excel 資料部分錯誤的處理
      假設 我上傳了包含 "10" 筆學校資料的 Excel 檔案
      而且 第 "5" 筆資料缺少必填欄位「學校名稱」
      當 AI 解析 Excel 內容
      那麼 AI 應顯示: "已解析 10 筆資料，其中 1 筆有錯誤"
      而且 AI 應在預覽表格中標示第 "5" 筆為錯誤
      而且 AI 應顯示錯誤訊息: "第 5 筆：缺少必填欄位「學校名稱」"
      而且 我應能在預覽表格中直接修正第 "5" 筆
      而且 修正後我可以點擊 "確認匯入" 匯入全部資料
    
    場景: Excel 資料部分錯誤選擇跳過匯入
      假設 Excel 預覽顯示 "10" 筆資料，其中第 "5" 筆有錯誤
      當 我點擊 "跳過錯誤筆，匯入其他筆" 按鈕
      那麼 應匯入 "9" 筆正確的學校資料
      而且 AI 應顯示: "✅ 已成功匯入 9 所學校"
      而且 AI 應顯示: "⚠️ 跳過 1 筆錯誤資料"
      而且 AI 應列出錯誤清單: "第 5 筆：缺少必填欄位「學校名稱」"

  規則: Excel 智能識別欄位
    
    場景: 上傳非標準格式的 Excel
      假設 我準備了一個 Excel 檔案
      而且 Excel 的欄位名稱為: "分校名稱"、"電話"、"校址"
      當 我上傳 Excel 檔案
      那麼 AI 應智能識別欄位對應關係:
        | Excel 欄位 | 系統欄位 |
        | 分校名稱   | 學校名稱 |
        | 電話       | 聯絡電話 |
        | 校址       | 地址     |
      而且 AI 應顯示識別結果讓我確認
      而且 AI 應允許我手動調整欄位對應

  規則: 填寫表單模式 - 新增機構教師
    
    場景: 填寫表單新增機構教師
      假設 我點擊了 "新增機構教師" 按鈕
      而且 我選擇 "填寫表單（快速）"
      當 AI 顯示教師資料表單
      那麼 表單應包含以下欄位:
        | 欄位名稱   | 是否必填 |
        | 教師姓名   | 是       |
        | Email      | 是       |
        | 手機號碼   | 否       |
      而且 表單應顯示可用授權數: "已使用 X / 總數 Y"
    
    場景: 新增教師時檢查授權數量
      假設 機構教師授權總數為 "10"
      而且 已使用授權數為 "10"
      當 我嘗試新增新教師
      那麼 AI 應提示: "⚠️ 教師授權數量已達上限（10/10），無法新增更多教師"
      而且 AI 應提供 "購買更多授權" 的連結

  規則: 填寫表單模式 - 新增學校班級
    
    場景: 填寫表單新增班級需選擇所屬學校
      假設 機構有學校 "台北分校" 和 "新竹分校"
      而且 我點擊了 "新增學校班級" 按鈕
      而且 我選擇 "填寫表單（快速）"
      當 AI 顯示班級資料表單
      那麼 表單應包含 "所屬學校" 下拉選單
      而且 下拉選單應列出: "台北分校"、"新竹分校"
      而且 表單應包含以下欄位:
        | 欄位名稱   | 是否必填 |
        | 所屬學校   | 是       |
        | 班級名稱   | 是       |
        | 年級       | 否       |

  規則: 填寫表單模式 - 新增班級學生
    
    場景: 填寫表單新增學生需選擇所屬班級
      假設 "台北分校" 有班級 "一年A班" 和 "一年B班"
      而且 我點擊了 "新增班級學生" 按鈕
      而且 我選擇 "填寫表單（快速）"
      當 AI 顯示學生資料表單
      那麼 表單應包含 "所屬學校" 下拉選單
      而且 我選擇學校後，應顯示 "所屬班級" 下拉選單
      而且 班級下拉選單應列出該學校的所有班級
      而且 表單應包含以下欄位:
        | 欄位名稱   | 是否必填 |
        | 所屬學校   | 是       |
        | 所屬班級   | 是       |
        | 學生姓名   | 是       |
        | Email      | 否       |
        | 學號       | 否       |

  規則: 持續對話流程
    
    場景: 成功新增後繼續新增其他資料
      假設 我剛成功新增了 "台北分校"
      而且 AI 詢問: "是否要繼續新增其他資料？"
      當 我點擊 "新增機構教師" 按鈕
      那麼 AI 應進入新增教師的流程
      而且 應保持在同一個對話框中
    
    場景: 關閉 AI 對話框
      假設 我在 AI 對話框中
      當 我點擊對話框的關閉按鈕
      那麼 對話框應關閉
      而且 我應回到資料管理頁面
      而且 頁面應顯示我已新增的資料清單
