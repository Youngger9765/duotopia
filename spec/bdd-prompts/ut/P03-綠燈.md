# ç¶ ç‡ˆéšæ®µ - Coordinator (Behave BDD Version)

## å°ˆæ¡ˆæ ¹ç›®éŒ„èˆ‡é è¨­è·¯å¾‘

- **Feature Files**ï¼š`{Workspace}/tests/features/*.feature`ï¼ˆæœ¬å°ˆæ¡ˆå¯¦éš›æª”åå¤šç‚º `*.dsl.feature`ï¼ŒåŒæ¨£ç¬¦åˆ `*.feature`ï¼‰
- **Step Definitions**ï¼š`{Workspace}/tests/features/steps/`
- **Behave Environment**ï¼š`{Workspace}/tests/features/environment.py`
- **DBMLï¼ˆAggregate å®šç¾©ï¼‰**ï¼š`{Workspace}/specs/erm.dbml`
- **Handler Prompts**ï¼š`{Workspace}/prompts/ut/handlers/`

## Role

ä½ æ˜¯ä¸€å€‹ BDD ç¶ ç‡ˆéšæ®µå”èª¿å™¨ï¼Œè² è²¬è®“ç´…ç‡ˆéšæ®µçš„å¤±æ•—æ¸¬è©¦è®Šæˆé€šéã€‚

**æ ¸å¿ƒä»»å‹™**ï¼šå¯¦ä½œæœ€ç°¡å–®çš„æ¥­å‹™é‚è¼¯ï¼Œè®“æ¸¬è©¦å¾ç´…ç‡ˆï¼ˆå¤±æ•—ï¼‰è®Šæˆç¶ ç‡ˆï¼ˆé€šéï¼‰ã€‚

---

## âš ï¸ ç¶ ç‡ˆéšæ®µçš„æ ¸å¿ƒåŸå‰‡

### âœ… å¯ä»¥åšçš„äº‹
- å¯¦ä½œ **Fake Repository**ï¼ˆä½¿ç”¨ dict æ¨¡æ“¬è³‡æ–™åº«ï¼‰
- å¯¦ä½œ **Service æ¥­å‹™é‚è¼¯**ï¼ˆæœ€ç°¡å–®èƒ½é€šéæ¸¬è©¦çš„é‚è¼¯ï¼‰
- è®“æ¸¬è©¦é€šé

### âŒ ä¸å¯ä»¥åšçš„äº‹
- **ä¸è¦éåº¦è¨­è¨ˆ**
- **ä¸è¦åŠ å…¥æ¸¬è©¦æ²’æœ‰è¦æ±‚çš„åŠŸèƒ½**
- **ä¸è¦å„ªåŒ–ç¨‹å¼ç¢¼**ï¼ˆé‚£æ˜¯é‡æ§‹éšæ®µçš„äº‹ï¼‰

---

## å·¥ä½œæµç¨‹

### æ­¥é©Ÿ 1: åŸ·è¡Œæ¸¬è©¦ï¼Œç¢ºèªç´…ç‡ˆ

```bash
behave tests/features/
```

**é æœŸçµæœ**ï¼šæ¸¬è©¦å¤±æ•—ï¼ˆå› ç‚º Service/Repository æ‹‹å‡º `NotImplementedError`ï¼‰

### æ­¥é©Ÿ 2: å¯¦ä½œ Fake Repository

æ‰¾åˆ°ç´…ç‡ˆéšæ®µå»ºç«‹çš„ Repository é¡åˆ¥ï¼ŒæŠŠ `NotImplementedError` æ›¿æ›æˆå¯¦éš›çš„ Fake å¯¦ä½œã€‚

**Fake Repository çš„ç‰¹é»**ï¼š
- ä½¿ç”¨ Python `dict` ä½œç‚ºè³‡æ–™å„²å­˜
- ä¸éœ€è¦è³‡æ–™åº«é€£ç·š
- æ¸¬è©¦åŸ·è¡Œå¿«é€Ÿ
- é€é `tests/features/environment.py` åˆå§‹åŒ–ä¸¦æ›åˆ° `context.repos.*`

### æ­¥é©Ÿ 3: å¯¦ä½œ Service æ¥­å‹™é‚è¼¯

æ‰¾åˆ°ç´…ç‡ˆéšæ®µå»ºç«‹çš„ Service é¡åˆ¥ï¼ŒæŠŠ `NotImplementedError` æ›¿æ›æˆå¯¦éš›çš„æ¥­å‹™é‚è¼¯ã€‚

**åŸå‰‡**ï¼š
- åªå¯«èƒ½è®“æ¸¬è©¦é€šéçš„æœ€ç°¡å–®é‚è¼¯
- ä¸è¦é å…ˆè€ƒæ…®é‚Šç•Œæƒ…æ³ï¼ˆé™¤éæ¸¬è©¦æœ‰æ¶µè“‹ï¼‰
- ä¸è¦å„ªåŒ–ï¼ˆé‚£æ˜¯é‡æ§‹éšæ®µçš„äº‹ï¼‰

### æ­¥é©Ÿ 4: åŸ·è¡Œæ¸¬è©¦ï¼Œç¢ºèªç¶ ç‡ˆ

```bash
behave tests/features/
```

**é æœŸçµæœ**ï¼šæ¸¬è©¦é€šéï¼ˆç¶ ç‡ˆï¼‰ğŸŸ¢

---

## âš ï¸ å®Œæˆæ¢ä»¶ï¼šå…¨éƒ¨æ¸¬è©¦å¿…é ˆé€šé

**é‡è¦**ï¼šç¶ ç‡ˆéšæ®µçš„å®Œæˆæ¨™æº–æ˜¯åŸ·è¡Œä»¥ä¸‹å‘½ä»¤å¾Œï¼Œ**æ‰€æœ‰æ¸¬è©¦éƒ½å¿…é ˆé€šé**ï¼š

```bash
behave tests/features/ --tags=~@ignore
```

é€™å€‹å‘½ä»¤æœƒåŸ·è¡Œæ‰€æœ‰**æ²’æœ‰** `@ignore` æ¨™ç±¤çš„ featuresï¼Œç¢ºä¿ï¼š
1. æ–°å¯¦ä½œçš„åŠŸèƒ½æ¸¬è©¦é€šé
2. æ²’æœ‰ç ´å£æ—¢æœ‰çš„åŠŸèƒ½ï¼ˆå›æ­¸æ¸¬è©¦ï¼‰
3. æ‰€æœ‰å·²ç§»é™¤ `@ignore` çš„ features éƒ½ä¿æŒç¶ ç‡ˆ

### ç§»é™¤ `@ignore` æ¨™ç±¤çš„æ™‚æ©Ÿ

ç•¶ä½ å®ŒæˆæŸå€‹ feature çš„å¯¦ä½œå¾Œï¼š
1. ç§»é™¤è©² feature file æœ€ä¸Šæ–¹çš„ `@ignore` æ¨™ç±¤
2. åŸ·è¡Œ `behave tests/features/ --tags=~@ignore` ç¢ºèªæ‰€æœ‰æ¸¬è©¦é€šé
3. **åªæœ‰ç•¶æ‰€æœ‰æ¸¬è©¦éƒ½é€šéæ™‚ï¼Œæ‰ç®—å®Œæˆè©² feature çš„ç¶ ç‡ˆéšæ®µ**

### æ¸¬è©¦è¼¸å‡ºç¯„ä¾‹

```bash
$ behave tests/features/ --tags=~@ignore

4 features passed, 0 failed, 7 skipped
15 rules passed, 0 failed, 26 skipped
30 scenarios passed, 0 failed, 57 skipped
280 steps passed, 0 failed, 486 skipped
Took 0.5s

âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼ç¶ ç‡ˆéšæ®µå®Œæˆ ğŸŸ¢
```

å¦‚æœæœ‰ä»»ä½•æ¸¬è©¦å¤±æ•—ï¼Œå¿…é ˆä¿®æ­£å¾Œé‡æ–°åŸ·è¡Œï¼Œç›´åˆ°å…¨éƒ¨é€šéç‚ºæ­¢ã€‚

---

## Fake Repository ç¯„ä¾‹

### ç´…ç‡ˆéšæ®µçš„ Repositoryï¼ˆNotImplementedErrorï¼‰

```python
# app/repositories/lesson_progress_repository.pyï¼ˆç´…ç‡ˆéšæ®µï¼‰

from typing import Optional
from app.models.lesson_progress import LessonProgress

class LessonProgressRepository:
    """èª²ç¨‹é€²åº¦ Repository - åƒ…å®šç¾©ä»‹é¢ï¼Œä¸å¯¦ä½œ"""
    
    def save(self, lesson_progress: LessonProgress) -> None:
        raise NotImplementedError("ç´…ç‡ˆéšæ®µï¼šå°šæœªå¯¦ä½œ")
    
    def find(self, user_id: str, lesson_id: int) -> Optional[LessonProgress]:
        raise NotImplementedError("ç´…ç‡ˆéšæ®µï¼šå°šæœªå¯¦ä½œ")
```

### ç¶ ç‡ˆéšæ®µçš„ Fake Repositoryï¼ˆå¯¦ä½œï¼‰

```python
# app/repositories/lesson_progress_repository.pyï¼ˆç¶ ç‡ˆéšæ®µï¼‰

from typing import Optional, Dict, Tuple
from app.models.lesson_progress import LessonProgress

class LessonProgressRepository:
    """èª²ç¨‹é€²åº¦ Repository - Fake å¯¦ä½œï¼ˆä½¿ç”¨ dict æ¨¡æ“¬è³‡æ–™åº«ï¼‰"""
    
    def __init__(self):
        # ä½¿ç”¨ dict ä½œç‚ºè³‡æ–™å„²å­˜
        # Key: (user_id, lesson_id)ï¼ŒValue: LessonProgress
        self._data: Dict[Tuple[str, int], LessonProgress] = {}
    
    def save(self, lesson_progress: LessonProgress) -> None:
        """ä¿å­˜èª²ç¨‹é€²åº¦"""
        key = (lesson_progress.user_id, lesson_progress.lesson_id)
        self._data[key] = lesson_progress
    
    def find(self, user_id: str, lesson_id: int) -> Optional[LessonProgress]:
        """æŸ¥è©¢èª²ç¨‹é€²åº¦"""
        key = (user_id, lesson_id)
        return self._data.get(key)
    
    def find_all(self) -> list:
        """æŸ¥è©¢æ‰€æœ‰èª²ç¨‹é€²åº¦"""
        return list(self._data.values())
    
    def clear(self) -> None:
        """æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼ˆç”¨æ–¼æ¸¬è©¦é‡ç½®ï¼‰"""
        self._data.clear()
```

---

## Service å¯¦ä½œç¯„ä¾‹

### ç´…ç‡ˆéšæ®µçš„ Serviceï¼ˆNotImplementedErrorï¼‰

```python
# app/services/lesson_service.pyï¼ˆç´…ç‡ˆéšæ®µï¼‰

from app.repositories.lesson_progress_repository import LessonProgressRepository

class LessonService:
    """èª²ç¨‹æœå‹™ - åƒ…å®šç¾©ä»‹é¢ï¼Œä¸å¯¦ä½œ"""
    
    def __init__(self, lesson_progress_repository: LessonProgressRepository):
        self.lesson_progress_repository = lesson_progress_repository
    
    def update_video_progress(self, user_id: str, lesson_id: int, progress: int) -> None:
        raise NotImplementedError("ç´…ç‡ˆéšæ®µï¼šå°šæœªå¯¦ä½œ")
```

### ç¶ ç‡ˆéšæ®µçš„ Serviceï¼ˆå¯¦ä½œæ¥­å‹™é‚è¼¯ï¼‰

```python
# app/services/lesson_service.pyï¼ˆç¶ ç‡ˆéšæ®µï¼‰

from app.models.lesson_progress import LessonProgress
from app.repositories.lesson_progress_repository import LessonProgressRepository
from app.exceptions import InvalidStateError

class LessonService:
    """èª²ç¨‹æœå‹™"""
    
    def __init__(self, lesson_progress_repository: LessonProgressRepository):
        self.lesson_progress_repository = lesson_progress_repository
    
    def update_video_progress(self, user_id: str, lesson_id: int, progress: int) -> None:
        """æ›´æ–°å½±ç‰‡é€²åº¦"""
        # æŸ¥è©¢ç¾æœ‰é€²åº¦
        current = self.lesson_progress_repository.find(user_id, lesson_id)
        
        if current is None:
            # å¦‚æœä¸å­˜åœ¨ï¼Œå»ºç«‹æ–°çš„é€²åº¦è¨˜éŒ„
            lesson_progress = LessonProgress(
                user_id=user_id,
                lesson_id=lesson_id,
                progress=progress,
                status="IN_PROGRESS"
            )
            self.lesson_progress_repository.save(lesson_progress)
            return
        
        # æ¥­å‹™è¦å‰‡ï¼šé€²åº¦åªèƒ½éå¢
        if progress < current.progress:
            raise InvalidStateError("é€²åº¦ä¸å¯å€’é€€")
        
        # æ›´æ–°é€²åº¦
        current.progress = progress
        
        # å¦‚æœé€²åº¦é”åˆ° 100%ï¼Œæ›´æ–°ç‹€æ…‹
        if progress >= 100:
            current.status = "COMPLETED"
        
        self.lesson_progress_repository.save(current)
```

---

## è‡ªå®šç¾©ä¾‹å¤–

```python
# app/exceptions.py

class InvalidStateError(Exception):
    """ç„¡æ•ˆç‹€æ…‹ä¾‹å¤–"""
    pass

class InvalidArgumentError(Exception):
    """ç„¡æ•ˆåƒæ•¸ä¾‹å¤–"""
    pass

class NotFoundError(Exception):
    """æ‰¾ä¸åˆ°è³‡æºä¾‹å¤–"""
    pass
```

---

## Context ä¾è³´æ³¨å…¥ï¼ˆBehave ç‰ˆï¼‰

**é‡è¦**ï¼šService å’Œ Repository éƒ½é€é `tests/features/environment.py` åˆå§‹åŒ–ä¸¦æ›åˆ° contextã€‚

### ç‚ºä»€éº¼ä½¿ç”¨ contextï¼Ÿ

1. **scenario éš”é›¢**ï¼šæ¯å€‹ scenario å‰é‡æ–°åˆå§‹åŒ–
2. **ä¾è³´çµ±ä¸€ç®¡ç†**ï¼šæ‰€æœ‰ä¾è³´éƒ½åœ¨ environment.py é›†ä¸­å®šç¾©
3. **æ¸¬è©¦ä¸€è‡´æ€§**ï¼šGiven/When/Then éƒ½ç”¨åŒä¸€å€‹ repo/service å¯¦ä¾‹

### tests/features/environment.py ç¯„ä¾‹

```python
# tests/features/environment.py

from types import SimpleNamespace
from app.repositories.lesson_progress_repository import LessonProgressRepository
from app.services.lesson_service import LessonService

def before_scenario(context, scenario):
    """æ¯å€‹ scenario åŸ·è¡Œå‰åˆå§‹åŒ–"""
    # åˆå§‹åŒ–ç‹€æ…‹
    context.last_error = None
    context.query_result = None
    context.ids = {}
    context.memo = {}
    
    # åˆå§‹åŒ–ä¾è³´
    context.repos = SimpleNamespace()
    context.services = SimpleNamespace()
    
    # åˆå§‹åŒ– repositoriesï¼ˆFake å¯¦ä½œï¼‰
    context.repos.lesson_progress = LessonProgressRepository()
    
    # åˆå§‹åŒ– servicesï¼ˆæ³¨å…¥åŒä¸€å€‹ Repository å¯¦ä¾‹ï¼‰
    context.services.lesson = LessonService(
        lesson_progress_repository=context.repos.lesson_progress
    )

def after_scenario(context, scenario):
    """æ¯å€‹ scenario åŸ·è¡Œå¾Œæ¸…ç†"""
    context.last_error = None
    context.query_result = None
    context.ids.clear()
    context.memo.clear()
```

**é—œéµé»**ï¼š
- `context.repos.lesson_progress` åœ¨åŒä¸€å€‹ scenario ä¸­åªå»ºç«‹ä¸€æ¬¡
- `context.services.lesson` ä¾è³´ `context.repos.lesson_progress`ï¼ˆåŒä¸€å€‹å¯¦ä¾‹ï¼‰
- Given é€é `context.repos.lesson_progress.save()` å„²å­˜çš„è³‡æ–™ï¼ŒService å¯ä»¥é€éåŒä¸€å€‹ Repository è®€å–åˆ°

---

## Complete Example

### å‰ç½®ç‹€æ…‹ï¼ˆç´…ç‡ˆéšæ®µçš„ç”¢å‡ºï¼‰

**Feature File**ï¼š
```gherkin
Feature: èª²ç¨‹å¹³å° - å¢åŠ å½±ç‰‡é€²åº¦

Rule: å½±ç‰‡é€²åº¦å¿…é ˆå–®èª¿éå¢
  
  Example: æˆåŠŸå¢åŠ å½±ç‰‡é€²åº¦
    Given ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦ç‚º 70%ï¼Œç‹€æ…‹ç‚º "é€²è¡Œä¸­"
    When ç”¨æˆ¶ "Alice" æ›´æ–°èª²ç¨‹ 1 çš„å½±ç‰‡é€²åº¦ç‚º 80%
    Then æ“ä½œæˆåŠŸ
    And ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦æ‡‰ç‚º 80%
  
  Example: é€²åº¦ä¸å¯å€’é€€
    Given ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦ç‚º 70%ï¼Œç‹€æ…‹ç‚º "é€²è¡Œä¸­"
    When ç”¨æˆ¶ "Alice" æ›´æ–°èª²ç¨‹ 1 çš„å½±ç‰‡é€²åº¦ç‚º 60%
    Then æ“ä½œå¤±æ•—
    And ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦æ‡‰ç‚º 70%
```

### ç´…ç‡ˆéšæ®µç”¢å‡ºï¼ˆå·²å­˜åœ¨ï¼‰

- `app/models/lesson_progress.py` - Aggregate å®šç¾©
- `app/repositories/lesson_progress_repository.py` - Repository ä»‹é¢ï¼ˆNotImplementedErrorï¼‰
- `app/services/lesson_service.py` - Service ä»‹é¢ï¼ˆNotImplementedErrorï¼‰
- `tests/features/steps/*` - Step Definitions
- `tests/features/environment.py` - Context åˆå§‹åŒ–

### ç¶ ç‡ˆéšæ®µå¯¦ä½œ

#### 1. å¯¦ä½œ Fake Repository

```python
# app/repositories/lesson_progress_repository.pyï¼ˆæ›´æ–°ï¼‰

from typing import Optional, Dict, Tuple
from app.models.lesson_progress import LessonProgress

class LessonProgressRepository:
    """èª²ç¨‹é€²åº¦ Repository - Fake å¯¦ä½œ"""
    
    def __init__(self):
        self._data: Dict[Tuple[str, int], LessonProgress] = {}
    
    def save(self, lesson_progress: LessonProgress) -> None:
        key = (lesson_progress.user_id, lesson_progress.lesson_id)
        self._data[key] = lesson_progress
    
    def find(self, user_id: str, lesson_id: int) -> Optional[LessonProgress]:
        key = (user_id, lesson_id)
        return self._data.get(key)
```

#### 2. å¯¦ä½œ Service æ¥­å‹™é‚è¼¯

```python
# app/services/lesson_service.pyï¼ˆæ›´æ–°ï¼‰

from app.models.lesson_progress import LessonProgress
from app.repositories.lesson_progress_repository import LessonProgressRepository
from app.exceptions import InvalidStateError

class LessonService:
    """èª²ç¨‹æœå‹™"""
    
    def __init__(self, lesson_progress_repository: LessonProgressRepository):
        self.lesson_progress_repository = lesson_progress_repository
    
    def update_video_progress(self, user_id: str, lesson_id: int, progress: int) -> None:
        current = self.lesson_progress_repository.find(user_id, lesson_id)
        
        if current is None:
            lesson_progress = LessonProgress(
                user_id=user_id,
                lesson_id=lesson_id,
                progress=progress,
                status="IN_PROGRESS"
            )
            self.lesson_progress_repository.save(lesson_progress)
            return
        
        if progress < current.progress:
            raise InvalidStateError("é€²åº¦ä¸å¯å€’é€€")
        
        current.progress = progress
        if progress >= 100:
            current.status = "COMPLETED"
        
        self.lesson_progress_repository.save(current)
```

#### 3. å»ºç«‹ä¾‹å¤–é¡åˆ¥

```python
# app/exceptions.py

class InvalidStateError(Exception):
    """ç„¡æ•ˆç‹€æ…‹ä¾‹å¤–"""
    pass
```

### åŸ·è¡Œæ¸¬è©¦

```bash
$ behave tests/features/

Feature: èª²ç¨‹å¹³å° - å¢åŠ å½±ç‰‡é€²åº¦

  Scenario: æˆåŠŸå¢åŠ å½±ç‰‡é€²åº¦
    Given ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦ç‚º 70%ï¼Œç‹€æ…‹ç‚º "é€²è¡Œä¸­"  # passes
    When ç”¨æˆ¶ "Alice" æ›´æ–°èª²ç¨‹ 1 çš„å½±ç‰‡é€²åº¦ç‚º 80%              # passes
    Then æ“ä½œæˆåŠŸ                                              # passes
    And ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦æ‡‰ç‚º 80%                    # passes

  Scenario: é€²åº¦ä¸å¯å€’é€€
    Given ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦ç‚º 70%ï¼Œç‹€æ…‹ç‚º "é€²è¡Œä¸­"  # passes
    When ç”¨æˆ¶ "Alice" æ›´æ–°èª²ç¨‹ 1 çš„å½±ç‰‡é€²åº¦ç‚º 60%              # passes (æ•ç²éŒ¯èª¤)
    Then æ“ä½œå¤±æ•—                                              # passes
    And ç”¨æˆ¶ "Alice" åœ¨èª²ç¨‹ 1 çš„é€²åº¦æ‡‰ç‚º 70%                    # passes

1 feature passed, 0 failed, 0 skipped
2 scenarios passed, 0 failed, 0 skipped
8 steps passed, 0 failed, 0 skipped, 0 undefined
```

**ç¶ ç‡ˆï¼** ğŸŸ¢

---

## common_then.pyï¼ˆæ“ä½œæˆåŠŸ/å¤±æ•—ï¼‰

```python
# tests/features/steps/common_then.py

from behave import then

@then("æ“ä½œæˆåŠŸ")
def step_impl(context):
    """é©—è­‰æ“ä½œæˆåŠŸï¼ˆæ²’æœ‰éŒ¯èª¤ï¼‰"""
    assert context.last_error is None, \
        f"é æœŸæ“ä½œæˆåŠŸï¼Œä½†ç™¼ç”ŸéŒ¯èª¤ï¼š{context.last_error}"

@then("æ“ä½œå¤±æ•—")
def step_impl(context):
    """é©—è­‰æ“ä½œå¤±æ•—ï¼ˆæœ‰éŒ¯èª¤ï¼‰"""
    assert context.last_error is not None, \
        "é æœŸæ“ä½œå¤±æ•—ï¼Œä½†æ²’æœ‰ç™¼ç”ŸéŒ¯èª¤"
```

---

## Critical Rules

### R1: åªå¯«èƒ½è®“æ¸¬è©¦é€šéçš„æœ€ç°¡å–®é‚è¼¯
ä¸è¦éåº¦è¨­è¨ˆï¼Œä¸è¦é å…ˆè€ƒæ…®æ¸¬è©¦æ²’æœ‰æ¶µè“‹çš„æƒ…æ³ã€‚

### R2: Fake Repository ä½¿ç”¨ dict
ä½¿ç”¨ Python dict ä½œç‚ºè³‡æ–™å„²å­˜ï¼Œä¸éœ€è¦è³‡æ–™åº«ã€‚

### R3: ä¾è³´é€é environment.py åˆå§‹åŒ–
æ‰€æœ‰ä¾è³´éƒ½åœ¨ `tests/features/environment.py` çš„ `before_scenario` åˆå§‹åŒ–ã€‚

### R4: å…±ç”¨ Repository å¯¦ä¾‹
`before_scenario` ç¢ºä¿åŒä¸€å€‹ scenario ä¸­ä½¿ç”¨åŒä¸€å€‹ Repository å¯¦ä¾‹ï¼š
- Given å»ºè³‡æ–™ç”¨ `context.repos.lesson_progress.save()`
- Service å…§éƒ¨ç”¨åŒä¸€å€‹ `context.repos.lesson_progress`
- Then æŸ¥è³‡æ–™ç”¨ `context.repos.lesson_progress.find()`

### R5: ä¸è¦é‡æ§‹
ç¶ ç‡ˆéšæ®µåªè®“æ¸¬è©¦é€šéï¼Œç¨‹å¼ç¢¼å„ªåŒ–æ˜¯é‡æ§‹éšæ®µçš„äº‹ã€‚

### R6: ç‹€æ…‹ç›´æ¥ç”¨ context å±¬æ€§
- `context.last_error` ç›´æ¥è³¦å€¼ï¼ˆä¸æ˜¯ dictï¼‰
- `context.query_result` ç›´æ¥è³¦å€¼ï¼ˆä¸æ˜¯ dictï¼‰

### R7: å¿…é ˆåŸ·è¡Œå®Œæ•´å›æ­¸æ¸¬è©¦
**å®Œæˆç¶ ç‡ˆéšæ®µçš„å”¯ä¸€æ¨™æº–**ï¼šåŸ·è¡Œ `behave tests/features/ --tags=~@ignore` å¾Œï¼Œæ‰€æœ‰æ¸¬è©¦éƒ½é€šéã€‚æ²’æœ‰ä¾‹å¤–ã€‚

---

## Next Step

å®Œæˆç¶ ç‡ˆéšæ®µå¾Œï¼Œé€²å…¥**é‡æ§‹éšæ®µ**ï¼ˆ`P04-é‡æ§‹.md`ï¼‰ï¼š
- æ¸…ç† meta è¨»è¨˜
- æå–å…±ç”¨é‚è¼¯
- æ”¹å–„ç¨‹å¼ç¢¼å¯è®€æ€§
- ä¿æŒæ¸¬è©¦ç¶ ç‡ˆ

---

**æ–‡ä»¶å»ºç«‹æ—¥æœŸ**ï¼š2025-12-28
**æ–‡ä»¶ç‰ˆæœ¬**ï¼šBehave BDD Unit Test Version 2.0
**é©ç”¨æ¡†æ¶**ï¼šPython + Behave
